<!DOCTYPE html>
<html lang="zh-tw">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MR Happy New Year 2021</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="wrapper">
  <div class="container">
    <div class="empty"><img src="images/empty.png"></div>
    <a class="gift" href="https://myrewards.app.link/chDrriBwkdb" target="_blank"></a>
    <div class="icon-wrap">
      <div data-id="1" class="icon-item"><img src="images/icon_1.png"></div>
      <div data-id="2" class="icon-item"><img src="images/icon_2.png"></div>
      <div data-id="3" class="icon-item"><img src="images/icon_3.png"></div>
    </div>
    <div class="card-wrap">
      <img id="card-img" src="images/card_1.png">
      <a id="d-link" class="btn-download" onclick="myDownload();"><img src="images/btn-download.png"></a>
    </div>
  </div>
</div>
<script>
  var element= document.getElementsByClassName('icon-item')
  var _id = 1;

  for(var i=0;i<element.length;i++){
    element[i].onclick = function(){
      _id = this.getAttribute('data-id')
      document.getElementById('card-img').src = "images/card_" + _id + ".png";
    }
  }

  function getImageDataURL(image) {
    var canvas = document.createElement('canvas');
    canvas.width = image.width;
    canvas.height = image.height;
    var ctx = canvas.getContext('2d');
    ctx.drawImage(image, 0, 0, image.width, image.height);
    var extension = image.src.substring(image.src.lastIndexOf('.') + 1).toLowerCase();
    return canvas.toDataURL('image/' + extension, 1);
  }

  function myDownload() {
    var url = "images/card_" + _id + ".png";
    var downloadName = "card_" + _id;
    var tag = document.createElement('a');
    tag.setAttribute('download', downloadName.replace(/\./g, 'ã€‚'));

    var image = new Image();
    image.src = url + '?time=' + new Date().getTime();
    image.setAttribute('crossOrigin', 'Anonymous');
    image.onload = () => {
      tag.href = getImageDataURL(image);
      tag.click();
    };
  }
</script>
</body>
</html>